import React,{useState}from'react'
import{sdk}from'@farcaster/miniapp-sdk'
export function WalletConnect(){const[address,setAddress]=useState<string|null>(null);const[chainId,setChainId]=useState<string|null>(null);const[connecting,setConnecting]=useState(false);async function connect(){try{setConnecting(true);const provider=await sdk.wallet.getEthereumProvider?.();if(!provider)throw new Error('No Ethereum provider available');const accounts:string[]=await provider.request({method:'eth_requestAccounts'});setAddress(accounts?.[0]??null);const hexChainId:string=await provider.request({method:'eth_chainId'});setChainId(hexChainId);provider.on?.('accountsChanged',(accs:string[])=>setAddress(accs?.[0]??null));provider.on?.('chainChanged',(cid:string)=>setChainId(cid))}catch(e){console.error('Wallet connect failed:',e);alert('Wallet connection failed.')}finally{setConnecting(false)}}return(<div className='card' style={{display:'grid',gap:8}}><div className='row' style={{alignItems:'center'}}><button className='btn' onClick={connect} disabled={connecting}>{connecting?'Connecting…':(address?'Reconnect Wallet':'Connect Wallet')}</button>{address&&<code style={{fontSize:12}}>Address: {address.slice(0,6)}…{address.slice(-4)}</code>}{chainId&&<code style={{fontSize:12,opacity:.7}}>Chain: {parseInt(chainId,16)}</code>}</div><div className='help'>Wallet provider is supplied by the Farcaster Mini App host (EIP-1193).</div></div>) }
